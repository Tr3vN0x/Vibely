<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vibely | Winter Diamond Lounge</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
:root {
    --gold: #d4af37;
    --ice-blue: #a5f3fc;
    --obsidian: #05050a;
    --glass: rgba(255, 255, 255, 0.05);
}

/* Global */
* { box-sizing: border-box; transition: all 0.3s ease; }
body { margin: 0; font-family: 'Inter', sans-serif; background: #080a12; color: #fff; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

/* Snow & Sparkles */
.snowflake { 
    color: #a5f3fc; text-shadow: 0 0 8px #a5f3fc, 0 0 12px #fff; position: fixed; top: -10%; z-index: 999; animation: fall linear infinite, sway 3s ease-in-out infinite alternate; pointer-events: none; opacity: 0.8; 
}
@keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }
@keyframes sway { 0% { transform: translateX(0) rotate(0deg); } 100% { transform: translateX(20px) rotate(45deg); } }

/* Header & Layout */
header { padding: 15px 40px; background: rgba(5, 5, 10, 0.95); border-bottom: 1px solid rgba(165, 243, 252, 0.2); display: flex; justify-content: space-between; align-items: center; z-index:2; }
.main-layout { display: grid; grid-template-columns: 240px 1fr 320px; flex-grow: 1; overflow: hidden; position: relative; }
.nav-sidebar { padding: 25px 15px; background: rgba(0,0,0,0.5); border-right: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; gap: 10px; backdrop-filter: blur(8px); }
.nav-btn { background: var(--glass); border: 1px solid transparent; color: #aaa; padding: 12px 20px; font-family: 'Cinzel', serif; cursor: pointer; border-radius: 4px; font-size: 0.8rem; transition: all 0.3s ease; }
.nav-btn:hover, .nav-btn.active { color: var(--ice-blue); border-color: var(--ice-blue); background: rgba(165, 243, 252, 0.1); box-shadow: 0 0 10px var(--ice-blue); }

/* Center Content */
#centerContent { overflow-y: auto; padding: 40px; background: radial-gradient(circle at top, #0c1220 0%, #05050a 100%); position: relative; z-index:1; }
.view-section { display: none; max-width: 900px; margin: 0 auto; }

/* Wheel */
.wheel-box { position: relative; width: 320px; height: 320px; margin: 20px auto; }
#wheel { width: 100%; height: 100%; border-radius: 50%; border: 8px solid var(--ice-blue); position: relative; background: conic-gradient(#0c1220 0 45deg, #1e293b 45deg 90deg, #0c1220 90deg 135deg, #1e293b 135deg 180deg, #0c1220 180deg 225deg, #1e293b 225deg 270deg, #0c1220 270deg 315deg, #1e293b 315deg 360deg); transition: transform 5s cubic-bezier(0.15, 0, 0.15, 1); box-shadow: 0 0 20px rgba(165,243,252,0.4), inset 0 0 15px rgba(165,243,252,0.2); }
.wheel-segment { position: absolute; width: 100%; height: 100%; text-align: center; padding-top: 20px; font-weight: bold; font-size: 0.7rem; color: var(--ice-blue); font-family: 'Cinzel'; text-shadow: 0 0 5px #a5f3fc; }

/* User Cards */
.card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px; }
.user-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(165,243,252,0.2); border-radius: 12px; padding: 25px; text-align: center; position: relative; box-shadow: 0 0 15px rgba(165,243,252,0.2); transition: transform 0.3s ease, box-shadow 0.3s ease; transform: translateY(20px); opacity: 0; animation: cardEnter 0.6s forwards; overflow: hidden;}
.user-card:hover { transform: scale(1.03); box-shadow: 0 0 35px rgba(165,243,252,0.6); }
.user-card::before { content: '❄'; position: absolute; font-size: 10px; opacity: 0.2; top: -5px; left: 50%; transform: translateX(-50%); animation: floatSnow 3s infinite; }
@keyframes cardEnter { to { transform: translateY(0); opacity:1; } }
@keyframes floatSnow { 0% {top:-5px} 50% {top:20px} 100% {top:-5px} }

.card-avatar { width: 80px; height: 80px; margin: 0 auto 10px; border: 2px solid var(--ice-blue); border-radius: 50%; overflow: hidden; }
.card-avatar img { width: 100%; height: 100%; object-fit: cover; }

.card-level { font-size: 0.6rem; color: #a5f3fc; margin-top: 2px; }
.card-xp { background: rgba(165,243,252,0.1); border-radius: 8px; height: 6px; width: 100%; margin-top: 5px; overflow: hidden; }
.card-xp-fill { background: var(--ice-blue); width: 0%; height: 100%; border-radius: 8px; transition: width 1s ease-in-out; }

/* Profile Editor */
.edit-box { background: var(--glass); padding: 25px; border-radius: 12px; border: 1px solid rgba(165,243,252,0.2); }
input { background: #111; border: 1px solid #333; color: #fff; padding: 10px; margin: 10px 0; width: 100%; border-radius: 5px; }

/* Right Sidebar Chat */
.right-sidebar { background: #000; border-left: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; padding: 15px; }
#chatBox { flex-grow: 1; overflow-y: auto; font-size: 0.8rem; }
.chat-msg { margin-bottom: 8px; padding: 8px; background: rgba(165,243,252,0.05); border-radius: 8px; border: 1px solid rgba(165,243,252,0.2); box-shadow: 0 0 5px rgba(165,243,252,0.3); }

/* Login Overlay */
#loginOverlay { position: fixed; inset: 0; background: #000; z-index: 1000; display: flex; align-items: center; justify-content: center; }
#loginOverlay input { margin-bottom: 10px; }
#loginOverlay button { margin-top: 10px; }

/* Shop */
.shop-grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap:20px; margin-top:20px; }
.shop-card { background: rgba(0,0,0,0.6); border: 1px solid rgba(165,243,252,0.2); border-radius:12px; padding:20px; text-align:center; transition: transform 0.3s ease, box-shadow 0.3s ease; position:relative; overflow:hidden;}
.shop-card:hover { transform: scale(1.05); box-shadow: 0 0 30px rgba(165,243,252,0.7); }
.shop-card .effect-name { font-family:'Cinzel'; color:var(--ice-blue); margin-bottom:5px; }
.shop-card .cost { color: var(--gold); font-weight:bold; margin-bottom:10px; }
.shop-card button { width:100%; cursor:pointer; }
.shop-card::before { content:'❄'; position:absolute; top:-10px; left:50%; font-size:12px; opacity:0.2; animation: floatSnow 4s infinite; }

/* Inventory */
.inventory-grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap:20px; margin-top:20px; }
.inventory-card { background: rgba(0,0,0,0.5); border:1px solid rgba(165,243,252,0.2); border-radius:12px; padding:15px; text-align:center; position:relative; }
.inventory-card .effect-name { font-family:'Cinzel'; color:var(--ice-blue); margin-bottom:5px; }
.inventory-card button { margin-top:8px; width:100%; cursor:pointer; }

/* Frost Epic Animation */
@keyframes snowFall {
    0% { transform: translateY(-10px) rotate(0deg); opacity: 0; }
    50% { opacity: 0.8; }
    100% { transform: translateY(100%); opacity: 0; }
}

.user-card.frostEpic {
    position: relative;
    overflow: hidden;
    border: 2px solid #a5f3fc;
    box-shadow: 0 0 20px #a5f3fc, 0 0 50px #fff inset;
}

.user-card.frostEpic .snowflakeEpic {
    position: absolute;
    color: #a5f3fc;
    text-shadow: 0 0 5px #fff, 0 0 10px #a5f3fc;
    top: -10px;
    font-size: 12px;
    animation: snowFall linear infinite;
    pointer-events: none;
    opacity: 0.7;
}
</style>
</head>
<body>

<div id="loginOverlay">
    <div style="text-align:center; border: 1px solid var(--ice-blue); padding: 40px; border-radius: 15px;">
        <h2 style="font-family:'Cinzel'; color:var(--ice-blue);">WINTER LOUNGE</h2>
        <input id="regName" placeholder="Username" style="display:none;">
        <input id="authEmail" type="email" placeholder="Email">
        <input id="authPass" type="password" placeholder="Password">
        <button class="nav-btn" style="width:100%;" onclick="handleAuth()">ENTER</button>
        <p onclick="toggleMode()" style="font-size:0.7rem; cursor:pointer; color:#666; margin-top:10px;">Switch Mode</p>
    </div>
</div>

<header>
    <div style="font-family:'Cinzel'; color:var(--ice-blue); letter-spacing:5px;">❄ DIAMOND LOUNGE</div>
    <div id="headerBalance" style="color:var(--ice-blue); font-weight:bold;">♦ 0</div>
</header>

<div id="mainView" class="main-layout" style="display:none">
    <nav class="nav-sidebar">
        <button class="nav-btn active" id="btn-explore" onclick="switchTab('explore')">Lounge</button>
        <button class="nav-btn" id="btn-wheel" onclick="switchTab('wheel')">Frost Vault</button>
        <button class="nav-btn" id="btn-profile" onclick="switchTab('profile')">Identity</button>
        <button class="nav-btn" id="btn-shop" onclick="switchTab('shop')">Shop</button>
        <button class="nav-btn" id="btn-inventory" onclick="switchTab('inventory')">Inventory</button>
        <button class="nav-btn" style="margin-top:auto; color:crimson;" onclick="auth.signOut()">Logout</button>
    </nav>

    <main id="centerContent">
        <!-- Lounge -->
        <section id="view-explore" class="view-section" style="display:block;">
            <div id="cardsContainer" class="card-grid"></div>
        </section>

        <!-- Wheel -->
        <section id="view-wheel" class="view-section" style="text-align:center;">
            <h2 style="font-family:'Cinzel'; color:var(--ice-blue);">FROST VAULT</h2>
            <div class="wheel-box">
                <div id="wheel">
                    <div class="wheel-segment" style="transform:rotate(0deg)">♦ 5</div>
                    <div class="wheel-segment" style="transform:rotate(45deg)">+50 XP</div>
                    <div class="wheel-segment" style="transform:rotate(90deg)">♦ 10</div>
                    <div class="wheel-segment" style="transform:rotate(135deg)">JACKPOT</div>
                    <div class="wheel-segment" style="transform:rotate(180deg)">♦ 1</div>
                    <div class="wheel-segment" style="transform:rotate(225deg)">+10 XP</div>
                    <div class="wheel-segment" style="transform:rotate(270deg)">♦ 25</div>
                    <div class="wheel-segment" style="transform:rotate(315deg)">SKIPPED</div>
                </div>
            </div>
            <button class="nav-btn" id="spinBtn" onclick="spinWheel()">ACTIVATE VAULT</button>
        </section>

        <!-- Profile -->
        <section id="view-profile" class="view-section">
            <div class="edit-box">
                <h3 style="font-family:'Cinzel'; color:var(--ice-blue);">Identity Editor</h3>
                <input id="newAvatar" placeholder="Avatar URL">
                <input id="newBadge" placeholder="Winter Badge (e.g. ❄️ Elite)">
                <button class="nav-btn" style="width:100%;" onclick="updateProfile()">Save Identity</button>
            </div>
        </section>

        <!-- Shop -->
        <section id="view-shop" class="view-section">
            <h2 style="font-family:'Cinzel'; color:var(--ice-blue); text-align:center;">Winter Shop</h2>
            <div id="shopContainer" class="shop-grid"></div>
        </section>

        <!-- Inventory -->
        <section id="view-inventory" class="view-section">
            <h2 style="font-family:'Cinzel'; color:var(--ice-blue); text-align:center;">Inventory</h2>
            <div id="inventoryContainer" class="inventory-grid"></div>
        </section>
    </main>

    <aside class="right-sidebar">
        <div id="chatBox"></div>
        <input id="chatInput" placeholder="Chat..." onkeypress="if(event.key==='Enter') sendChat()">
    </aside>
</div>

<script>
const OWNER_UID = 'pqPGbhBjvrVrgDrmUBa4J2ynmkW2';
const firebaseConfig = {
    apiKey: "AIzaSyCDll8RH1kzGOf-ixJmSlHXGssOHSMlO3s",
    authDomain: "vibely-5128e.firebaseapp.com",
    projectId: "vibely-5128e",
    storageBucket: "vibely-5128e.firebasestorage.app",
    messagingSenderId: "1048550825812",
    appId: "1:1048550825812:web:fc5bbba51e065807ffb2c1"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

let isLogin = true;
let myProfile = null;

/* Snow Effect */
setInterval(() => {
    const s = document.createElement('div');
    s.className = 'snowflake';
    s.innerHTML = Math.random() < 0.8 ? '❄' : '✨';
    s.style.left = Math.random() * 100 + 'vw';
    s.style.fontSize = Math.random() * 25 + 10 + 'px';
    s.style.opacity = Math.random() * 0.5 + 0.5;
    s.style.animationDuration = (Math.random() * 3 + 2) + 's';
    s.style.transform = `rotate(${Math.random()*360}deg)`;
    document.body.appendChild(s);
    setTimeout(() => s.remove(), 7000);
}, 150);

function toggleMode() { isLogin = !isLogin; document.getElementById('regName').style.display = isLogin ? 'none' : 'block'; }

async function handleAuth() {
    const e = document.getElementById('authEmail').value;
    const p = document.getElementById('authPass').value;
    const n = document.getElementById('regName').value;
    if (isLogin) await auth.signInWithEmailAndPassword(e, p);
    else {
        const r = await auth.createUserWithEmailAndPassword(e, p);
        await db.collection('users').doc(r.user.uid).set({ 
            name: n, vibes: 50, xp: 0, avatar: "", badge: "❄️ Newcomer", inventory:{}, equipped:{} 
        });
    }
}

/* Switch Tab */
function switchTab(t) {
    document.querySelectorAll('.view-section').forEach(v => v.style.display='none');
    document.getElementById('view-' + t).style.display='block';
    document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
    document.getElementById('btn-' + t).classList.add('active');
}

/* Shop Items */
const shopItems = [
  {id:'sparkleAura', name:'Sparkle Aura', cost:50, desc:'Shimmering aura around avatar', type:'aura'},
  {id:'frostBorder', name:'Frost Border', cost:75, desc:'Glowing icy border on profile cards', type:'cardEffect'},
  {id:'snowTrail', name:'Snow Trail', cost:100, desc:'Snowflakes drift when hovering your card', type:'cardEffect'},
  {id:'shimmerXP', name:'Shimmer XP Bar', cost:40, desc:'XP bar glows with winter shimmer', type:'xpBar'},
  {id:'eliteBadge', name:'Elite Badge ❄', cost:30, desc:'Exclusive winter badge', type:'badge'},
  {id:'eliteAura', name:'Elite Aura', cost:200, desc:'Premium glowing aura', type:'aura'},
  {id:'frostEpic', name:'Frost Epic ❄', cost:1000, desc:'Epic icy aura with snow cascading down your profile card', type:'cardEffect'}
];

/* Load Shop */
function loadShop() {
    const cont = document.getElementById('shopContainer'); cont.innerHTML='';
    shopItems.forEach(item=>{
        cont.innerHTML += `
        <div class="shop-card">
            <div class="effect-name">${item.name}</div>
            <div class="desc" style="font-size:0.7rem; color:#aaa; margin-bottom:5px;">${item.desc}</div>
            <div class="cost">♦ ${item.cost}</div>
            <button onclick="buyItem('${item.id}')">Purchase</button>
        </div>`;
    });
}

/* Buy Item */
async function buyItem(itemId) {
    const item = shopItems.find(i=>i.id===itemId);
    if(OWNER_UID!==auth.currentUser.uid && myProfile.vibes < item.cost){ alert("Not enough diamonds!"); return; }
    const userRef = db.collection('users').doc(auth.currentUser.uid);
    const updatedInv = {...myProfile.inventory}; updatedInv[itemId]=true;
    await userRef.update({ 
        vibes: OWNER_UID!==auth.currentUser.uid ? firebase.firestore.FieldValue.increment(-item.cost) : myProfile.vibes, 
        inventory: updatedInv 
    });
    alert(`Purchased: ${item.name}`);
    loadInventory();
}

/* Inventory UI */
function loadInventory() {
    const cont = document.getElementById('inventoryContainer'); cont.innerHTML='';
    for(const id in myProfile.inventory){
        const item = shopItems.find(i=>i.id===id);
        if(!item) continue;
        const equipped = myProfile.equipped[item.type]===id;
        cont.innerHTML+=`
        <div class="inventory-card">
            <div class="effect-name">${item.name}</div>
            <div style="font-size:0.7rem; color:#aaa;">${equipped?'Equipped':'Owned'}</div>
            <button onclick="equipItem('${id}')">${equipped?'Unequip':'Equip'}</button>
        </div>`;
    }
}

/* Equip Item */
async function equipItem(itemId){
    const item = shopItems.find(i=>i.id===itemId);
    if(!item) return;
    const eq = {...myProfile.equipped};
    if(eq[item.type]===itemId) eq[item.type]=null;
    else eq[item.type]=itemId;
    await db.collection('users').doc(auth.currentUser.uid).update({equipped:eq});
}

/* XP Helper */
function xpPercent(xp){ return Math.min((xp%100)/100*100,100); }

/* Load App */
function loadApp(uid){
    db.collection('users').doc(uid).onSnapshot(d=>{
        myProfile = d.data();
        document.getElementById('headerBalance').innerText=`♦ ${myProfile.vibes}`;
        loadInventory();
    });

    db.collection('users').onSnapshot(snap=>{
        const cont = document.getElementById('cardsContainer'); cont.innerHTML='';
        snap.forEach((d,i)=>{
            const u=d.data();
            const level = Math.floor(u.xp/100)+1;
            const xpFill = xpPercent(u.xp);

            let aura='', frost='', snow='', shimmer='', badge='';
            if(u.equipped){
                if(u.equipped.aura=== 'sparkleAura') aura='box-shadow:0 0 20px rgba(165,243,252,0.8);';
                if(u.equipped.aura==='eliteAura') aura='box-shadow:0 0 35px gold,0 0 50px #a5f3fc;';
                if(u.equipped.cardEffect==='frostBorder') frost='border:2px solid #a5f3fc;';
                if(u.equipped.cardEffect==='snowTrail') snow='position:relative;';
                if(u.equipped.xpBar==='shimmer') shimmer='background: linear-gradient(90deg,#a5f3fc,#fff);';
                if(u.equipped.badge==='eliteBadge') badge='❄️ Elite';
            }

            let frostClass = '';
            let snowHTML = '';
            if(u.equipped.cardEffect === 'frostEpic'){
                frostClass = 'frostEpic';
                for(let s=0; s<10; s++){
                    const left = Math.random()*90 + '%';
                    const delay = Math.random()*5 + 's';
                    const size = Math.random()*8+6 + 'px';
                    snowHTML += `<div class="snowflakeEpic" style="left:${left}; animation-duration:${Math.random()*5+5}s; font-size:${size}; animation-delay:${delay}">❄</div>`;
                }
            }

            cont.innerHTML += `
            <div class="user-card ${frostClass}" style="${aura}${frost}${snow};animation-delay:${i*0.1}s">
                ${snowHTML}
                <div class="card-avatar"><img src="${u.avatar || 'https://api.dicebear.com/7.x/bottts/svg?seed='+u.name}"></div>
                <div style="font-family:'Cinzel'; color:var(--ice-blue);">${u.name}</div>
                <div style="font-size:0.6rem; color:#888; margin-bottom:5px;">${badge || u.badge || ''}</div>
                <div style="color:var(--gold); font-size:0.8rem;">♦ ${u.vibes}</div>
                <div class="card-level">Lvl ${level}</div>
                <div class="card-xp"><div class="card-xp-fill" style="width:${xpFill}%; ${shimmer}"></div></div>
            </div>`;
        });
    });
}

/* Wheel */
async function spinWheel(){
    const userRef=db.collection('users').doc(auth.currentUser.uid);
    const uSnap = await userRef.get();
    const u = uSnap.data();
    if(auth.currentUser.uid!==OWNER_UID){
        const last = u.lastSpin?u.lastSpin.toDate():new Date(0);
        const now = new Date();
        if(now-last<24*60*60*1000){ alert("You can only spin once per day."); return; }
    }

    let index; do { index = Math.floor(Math.random()*8); } while(index===3 && auth.currentUser.uid!==OWNER_UID);
    const rot=3600+(index*45);
    document.getElementById('wheel').style.transform=`rotate(${rot}deg)`;
    document.getElementById('spinBtn').disabled=true;

    setTimeout(async()=>{
        const rewards=[{v:5},{x:50},{v:10},{x:1000},{v:1},{x:10},{v:25},{v:0}];
        const win=rewards[index]; const up={};
        if(win.v) up.vibes=firebase.firestore.FieldValue.increment(win.v);
        if(win.x) up.xp=firebase.firestore.FieldValue.increment(win.x);
        if(auth.currentUser.uid!==OWNER_UID) up.lastSpin=firebase.firestore.FieldValue.serverTimestamp();
        await userRef.update(up);
        document.getElementById('spinBtn').disabled=false;
    },5500);
}

/* Profile */
async function updateProfile(){
    const avatar=document.getElementById('newAvatar').value;
    const badge=document.getElementById('newBadge').value;
    await db.collection('users').doc(auth.currentUser.uid).update({ avatar,badge });
    alert("Identity Updated");
}

/* Chat */
function sendChat(){
    const msg=document.getElementById('chatInput').value;
    if(!msg) return;
    db.collection('chat').add({ user: myProfile.name,msg, time:firebase.firestore.FieldValue.serverTimestamp() });
    document.getElementById('chatInput').value='';
}
db.collection('chat').orderBy('time','desc').limit(15).onSnapshot(s=>{
    const box=document.getElementById('chatBox'); box.innerHTML='';
    s.docs.reverse().forEach(d=>box.innerHTML+=`<div class="chat-msg"><b>${d.data().user}:</b> ${d.data().msg}</div>`);
    box.scrollTop=box.scrollHeight;
});

/* Auth State */
auth.onAuthStateChanged(user => {
    if (user) {
        document.getElementById('loginOverlay').style.display = 'none';
        document.getElementById('mainView').style.display = 'grid';
        loadApp(user.uid);
        loadShop();
    }
});
</script>
</body>
</html>
