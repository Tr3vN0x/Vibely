<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vibely | Winter Diamond Lounge</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
:root { --gold:#d4af37; --ice-blue:#a5f3fc; --obsidian:#05050a; --glass:rgba(255,255,255,0.05); }

* { box-sizing:border-box; transition:all 0.3s ease; }
body { margin:0; font-family:'Inter',sans-serif; background:#080a12; color:#fff; height:100vh; overflow:hidden; display:flex; flex-direction:column; }
body::before { content:''; position:fixed; inset:0; background:radial-gradient(circle at top, rgba(165,243,252,0.05), transparent 70%); pointer-events:none; z-index:1; }

/* Snow & Sparkles */
.snowflake { color:#a5f3fc; text-shadow:0 0 8px #a5f3fc,0 0 12px #fff; position:fixed; top:-10%; z-index:999; animation:fall linear infinite,sway 3s ease-in-out infinite alternate; pointer-events:none; opacity:0.8; }
@keyframes fall { to { transform:translateY(110vh) rotate(360deg); } }
@keyframes sway { 0%{transform:translateX(0) rotate(0deg);} 100%{transform:translateX(20px) rotate(45deg);} }

/* UI Shell */
header { padding:15px 40px; background:rgba(5,5,10,0.95); border-bottom:1px solid rgba(165,243,252,0.2); display:flex; justify-content:space-between; align-items:center; z-index:2; }
.main-layout { display:grid; grid-template-columns:240px 1fr 320px; flex-grow:1; overflow:hidden; position:relative; }
.nav-sidebar { padding:25px 15px; background:rgba(0,0,0,0.5); border-right:1px solid rgba(255,255,255,0.1); display:flex; flex-direction:column; gap:10px; backdrop-filter:blur(8px); }
.nav-btn { background:var(--glass); border:1px solid transparent; color:#aaa; padding:12px 20px; font-family:'Cinzel',serif; cursor:pointer; border-radius:4px; font-size:0.8rem; transition:all 0.3s ease; }
.nav-btn:hover, .nav-btn.active { color:var(--ice-blue); border-color:var(--ice-blue); background:rgba(165,243,252,0.1); box-shadow:0 0 10px var(--ice-blue); }

#centerContent { overflow-y:auto; padding:40px; background:radial-gradient(circle at top, #0c1220 0%, #05050a 100%); position:relative; z-index:1; }
.view-section { display:none; max-width:900px; margin:0 auto; }

/* Wheel */
.wheel-box { position:relative; width:320px; height:320px; margin:20px auto; }
#wheel { width:100%; height:100%; border-radius:50%; border:8px solid var(--ice-blue); position:relative; background:conic-gradient(#0c1220 0 45deg, #1e293b 45deg 90deg, #0c1220 90deg 135deg, #1e293b 135deg 180deg, #0c1220 180deg 225deg, #1e293b 225deg 270deg, #0c1220 270deg 315deg, #1e293b 315deg 360deg); transition:transform 5s cubic-bezier(0.15,0,0.15,1); box-shadow:0 0 20px rgba(165,243,252,0.4), inset 0 0 15px rgba(165,243,252,0.2); }
.wheel-segment { position:absolute; width:100%; height:100%; text-align:center; padding-top:20px; font-weight:bold; font-size:0.7rem; color:var(--ice-blue); font-family:'Cinzel'; text-shadow:0 0 5px #a5f3fc; }

/* User Cards */
.card-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); gap:20px; }
.user-card { background:rgba(255,255,255,0.05); border:1px solid rgba(165,243,252,0.2); border-radius:12px; padding:25px; text-align:center; position:relative; box-shadow:0 0 15px rgba(165,243,252,0.2); transition:transform 0.3s ease, box-shadow 0.3s ease; transform:translateY(20px); opacity:0; animation:cardEnter 0.6s forwards; overflow:hidden;}
.user-card:hover { transform:scale(1.03); box-shadow:0 0 35px rgba(165,243,252,0.6); }
.user-card::before { content:'❄'; position:absolute; font-size:10px; opacity:0.2; top:-5px; left:50%; transform:translateX(-50%); animation:floatSnow 3s infinite; }
@keyframes cardEnter { to{transform:translateY(0); opacity:1;} }
@keyframes floatSnow { 0%{top:-5px} 50%{top:20px} 100%{top:-5px} }

.card-avatar { width:80px; height:80px; margin:0 auto 10px; border:2px solid var(--ice-blue); border-radius:50%; overflow:hidden; }
.card-avatar img { width:100%; height:100%; object-fit:cover; }

.card-level { font-size:0.6rem; color:#a5f3fc; margin-top:2px; }
.card-xp { background:rgba(165,243,252,0.1); border-radius:8px; height:6px; width:100%; margin-top:5px; overflow:hidden; }
.card-xp-fill { background:var(--ice-blue); width:0%; height:100%; border-radius:8px; transition:width 1s ease-in-out; }

/* Profile Editor */
.edit-box { background:var(--glass); padding:25px; border-radius:12px; border:1px solid rgba(165,243,252,0.2); }
input { background:#111; border:1px solid #333; color:#fff; padding:10px; margin:10px 0; width:100%; border-radius:5px; }

/* Right Sidebar Chat */
.right-sidebar { background:#000; border-left:1px solid rgba(255,255,255,0.1); display:flex; flex-direction:column; padding:15px; }
#chatBox { flex-grow:1; overflow-y:auto; font-size:0.8rem; }
.chat-msg { margin-bottom:8px; padding:8px; background:rgba(165,243,252,0.05); border-radius:8px; border:1px solid rgba(165,243,252,0.2); box-shadow:0 0 5px rgba(165,243,252,0.3); }

/* Login Overlay */
#loginOverlay { position:fixed; inset:0; background:#000; z-index:1000; display:flex; align-items:center; justify-content:center; }
#loginOverlay input { margin-bottom:10px; }
#loginOverlay button { margin-top:10px; }

/* Shop / Inventory Cards */
.shop-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:20px; margin-top:20px; }
.shop-card { background:rgba(0,0,0,0.6); border:1px solid rgba(165,243,252,0.2); border-radius:12px; padding:20px; text-align:center; transition:transform 0.3s ease, box-shadow 0.3s ease; position:relative; overflow:hidden;}
.shop-card:hover { transform:scale(1.05); box-shadow:0 0 30px rgba(165,243,252,0.7); }
.shop-card .effect-name { font-family:'Cinzel'; color:var(--ice-blue); margin-bottom:5px; }
.shop-card .cost { color:var(--gold); font-weight:bold; margin-bottom:10px; }
.shop-card button { width:100%; cursor:pointer; }
.shop-card::before { content:'❄'; position:absolute; top:-10px; left:50%; font-size:12px; opacity:0.2; animation:floatSnow 4s infinite; }
</style>
</head>
<body>

<div id="loginOverlay">
    <div style="text-align:center; border:1px solid var(--ice-blue); padding:40px; border-radius:15px;">
        <h2 style="font-family:'Cinzel'; color:var(--ice-blue);">WINTER LOUNGE</h2>
        <input id="regName" placeholder="Username" style="display:none;">
        <input id="authEmail" type="email" placeholder="Email">
        <input id="authPass" type="password" placeholder="Password">
        <button class="nav-btn" style="width:100%;" onclick="handleAuth()">ENTER</button>
        <p onclick="toggleMode()" style="font-size:0.7rem; cursor:pointer; color:#666; margin-top:10px;">Switch Mode</p>
    </div>
</div>

<header>
    <div style="font-family:'Cinzel'; color:var(--ice-blue); letter-spacing:5px;">❄ DIAMOND LOUNGE</div>
    <div id="headerBalance" style="color:var(--ice-blue); font-weight:bold;">♦ 0</div>
</header>

<div id="mainView" class="main-layout" style="display:none">
    <nav class="nav-sidebar">
        <button class="nav-btn active" id="btn-explore" onclick="switchTab('explore')">Lounge</button>
        <button class="nav-btn" id="btn-wheel" onclick="switchTab('wheel')">Frost Vault</button>
        <button class="nav-btn" id="btn-profile" onclick="switchTab('profile')">Identity</button>
        <button class="nav-btn" id="btn-shop" onclick="switchTab('shop')">Shop</button>
        <button class="nav-btn" id="btn-inventory" onclick="switchTab('inventory')">Inventory</button>
        <button class="nav-btn" style="margin-top:auto; color:crimson;" onclick="auth.signOut()">Logout</button>
    </nav>

    <main id="centerContent">
        <!-- Lounge -->
        <section id="view-explore" class="view-section" style="display:block;">
            <div id="cardsContainer" class="card-grid"></div>
        </section>

        <!-- Wheel -->
        <section id="view-wheel" class="view-section" style="text-align:center;">
            <h2 style="font-family:'Cinzel'; color:var(--ice-blue);">FROST VAULT</h2>
            <div class="wheel-box">
                <div id="wheel">
                    <div class="wheel-segment" style="transform:rotate(0deg)">♦ 5</div>
                    <div class="wheel-segment" style="transform:rotate(45deg)">+50 XP</div>
                    <div class="wheel-segment" style="transform:rotate(90deg)">♦ 10</div>
                    <div class="wheel-segment" style="transform:rotate(135deg)">JACKPOT</div>
                    <div class="wheel-segment" style="transform:rotate(180deg)">♦ 1</div>
                    <div class="wheel-segment" style="transform:rotate(225deg)">+10 XP</div>
                    <div class="wheel-segment" style="transform:rotate(270deg)">♦ 25</div>
                    <div class="wheel-segment" style="transform:rotate(315deg)">SKIPPED</div>
                </div>
            </div>
            <button class="nav-btn" id="spinBtn" onclick="spinWheel()">ACTIVATE VAULT</button>
        </section>

        <!-- Profile -->
        <section id="view-profile" class="view-section">
            <div class="edit-box">
                <h3 style="font-family:'Cinzel'; color:var(--ice-blue);">Identity Editor</h3>
                <input id="newAvatar" placeholder="Avatar URL">
                <input id="newBadge" placeholder="Winter Badge (e.g. ❄️ Elite)">
                <button class="nav-btn" style="width:100%;" onclick="updateProfile()">Save Identity</button>
            </div>
        </section>

        <!-- Shop -->
        <section id="view-shop" class="view-section">
            <h2 style="font-family:'Cinzel'; color:var(--ice-blue); text-align:center;">Winter Shop</h2>
            <div id="shopContainer" class="shop-grid"></div>
        </section>

        <!-- Inventory -->
        <section id="view-inventory" class="view-section">
            <h2 style="font-family:'Cinzel'; color:var(--ice-blue); text-align:center;">Inventory</h2>
            <div id="inventoryContainer" class="shop-grid"></div>
        </section>
    </main>

    <aside class="right-sidebar">
        <div id="chatBox"></div>
        <input id="chatInput" placeholder="Chat..." onkeypress="if(event.key==='Enter') sendChat()">
    </aside>
</div>

<script>
const firebaseConfig={apiKey:"AIzaSyCDll8RH1kzGOf-ixJmSlHXGssOHSMlO3s",authDomain:"vibely-5128e.firebaseapp.com",projectId:"vibely-5128e",storageBucket:"vibely-5128e.firebasestorage.app",messagingSenderId:"1048550825812",appId:"1:1048550825812:web:fc5bbba51e065807ffb2c1"};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore(),auth=firebase.auth();

let isLogin=true,myProfile=null;

/* Snow Effect */
setInterval(()=>{const s=document.createElement('div'); s.className='snowflake'; s.innerHTML=Math.random()<0.8?'❄':'✨'; s.style.left=Math.random()*100+'vw'; s.style.fontSize=Math.random()*25+10+'px'; s.style.opacity=Math.random()*0.5+0.5; s.style.animationDuration=(Math.random()*3+2)+'s'; s.style.transform=`rotate(${Math.random()*360}deg)`; document.body.appendChild(s); setTimeout(()=>s.remove(),7000); },150);

function toggleMode(){ isLogin=!isLogin; document.getElementById('regName').style.display=isLogin?'none':'block'; }

async function handleAuth(){
    const e=document.getElementById('authEmail').value, p=document.getElementById('authPass').value, n=document.getElementById('regName').value;
    if(isLogin) await auth.signInWithEmailAndPassword(e,p);
    else { const r=await auth.createUserWithEmailAndPassword(e,p); await db.collection('users').doc(r.user.uid).set({name:n,vibes:50,xp:0,avatar:"",badge:"❄️ Newcomer",inventory:{},equipped:{}}); }
}

auth.onAuthStateChanged(user=>{
    if(user){ document.getElementById('loginOverlay').style.display='none'; document.getElementById('mainView').style.display='grid'; loadApp(user.uid); loadShop(); loadInventory(); }
});

function switchTab(t){ document.querySelectorAll('.view-section').forEach(v=>v.style.display='none'); document.getElementById('view-'+t).style.display='block'; document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active')); document.getElementById('btn-'+t).classList.add('active'); }

/* Shop Items */
const shopItems=[
    {id:'sparkleAura',name:'Sparkle Aura',cost:50,desc:'Shimmering aura around avatar'},
    {id:'frostBorder',name:'Frost Border',cost:75,desc:'Glowing icy border on profile cards'},
    {id:'snowTrail',name:'Snow Trail',cost:100,desc:'Snowflakes drift when hovering your card'},
    {id:'shimmerXP',name:'Shimmer XP Bar',cost:40,desc:'XP bar glows with winter shimmer'},
    {id:'eliteBadge',name:'Elite Badge ❄',cost:30,desc:'Exclusive winter badge'}
];
</script>
