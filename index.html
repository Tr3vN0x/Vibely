<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibely | Winter Diamond Lounge</title>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        :root { --gold: #d4af37; --ice-blue: #a5f3fc; --obsidian: #05050a; --glass: rgba(255, 255, 255, 0.05); }
        
        * { box-sizing: border-box; transition: all 0.3s ease; }
        body { 
            margin: 0; font-family: 'Inter', sans-serif; background: #080a12; color: #fff; 
            height: 100vh; overflow: hidden; display: flex; flex-direction: column; 
        }

        /* --- UI SHELL --- */
        header { 
            padding: 10px 20px; background: rgba(5, 5, 10, 0.95); 
            border-bottom: 1px solid rgba(165, 243, 252, 0.2); 
            display: flex; justify-content: space-between; align-items: center; z-index: 100; 
        }

        .main-layout { 
            display: grid; grid-template-columns: 240px 1fr 300px; 
            flex-grow: 1; overflow: hidden; position: relative; 
        }

        /* Desktop Sidebar */
        .nav-sidebar { 
            padding: 20px 15px; background: rgba(0,0,0,0.5); 
            border-right: 1px solid rgba(255,255,255,0.1); 
            display: flex; flex-direction: column; gap: 10px; 
        }

        #centerContent { 
            overflow-y: auto; padding: 20px; 
            background: radial-gradient(circle at top, #0c1220 0%, #05050a 100%); 
        }

        .view-section { display: none; width: 100%; max-width: 1000px; margin: 0 auto; }

        /* --- MOBILE RESPONSIVENESS --- */
        @media (max-width: 900px) {
            .main-layout { grid-template-columns: 1fr; }
            .nav-sidebar { 
                position: fixed; bottom: 0; left: 0; width: 100%; height: 60px; 
                flex-direction: row; padding: 5px; justify-content: space-around; 
                border-right: none; border-top: 1px solid rgba(255,255,255,0.1); z-index: 1000;
            }
            .right-sidebar { display: none; } /* Hide chat on mobile to save space */
            #centerContent { padding-bottom: 80px; }
            .nav-btn { font-size: 0.6rem; padding: 5px; flex: 1; text-align: center; }
            header { font-size: 0.8rem; }
        }

        /* --- BUTTONS & INPUTS --- */
        .nav-btn { 
            background: var(--glass); border: 1px solid transparent; color: #aaa; 
            padding: 12px; font-family: 'Cinzel', serif; cursor: pointer; border-radius: 4px; 
        }
        .nav-btn.active { color: var(--ice-blue); border-color: var(--ice-blue); background: rgba(165, 243, 252, 0.1); }
        input { background: #111; border: 1px solid #333; color: #fff; padding: 12px; margin: 5px 0; width: 100%; border-radius: 5px; }

        /* --- MYTHIC & LEGENDARY CARDS --- */
        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .user-card { 
            background: rgba(255,255,255,0.05); border: 1px solid rgba(165, 243, 252, 0.2); 
            border-radius: 12px; padding: 20px; text-align: center; position: relative; 
            overflow: hidden; z-index: 1;
        }

        /* Mythic: Glitch */
        .glitch-card { border: 2px solid #00f2ff !important; animation: glitchShake 0.4s infinite; }
        @keyframes glitchShake {
            0% { transform: translate(0); }
            25% { transform: translate(-1px, 1px); filter: hue-rotate(45deg); }
            50% { transform: translate(1px, -1px); }
            100% { transform: translate(0); }
        }

        /* Mythic: Supernova */
        .supernova-card::before {
            content: ''; position: absolute; top: 50%; left: 50%; width: 200%; height: 200%;
            background: conic-gradient(from 0deg, transparent, var(--ice-blue), transparent 30%);
            animation: rotateFull 3s linear infinite; transform: translate(-50%, -50%); z-index: -1;
        }
        @keyframes rotateFull { from { transform: translate(-50%, -50%) rotate(0deg); } to { transform: translate(-50%, -50%) rotate(360deg); } }

        /* Mythic: Frost Breath */
        .breath-card::after {
            content: '☁'; position: absolute; bottom: -20px; left: 50%; font-size: 40px;
            filter: blur(10px); opacity: 0.4; animation: steamRise 2s infinite ease-out;
        }
        @keyframes steamRise { 0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 0; } 50% { opacity: 0.5; } 100% { transform: translateX(-50%) translateY(-80px) scale(2); opacity: 0; } }

        .card-avatar { width: 70px; height: 70px; margin: 0 auto 10px; border: 2px solid var(--ice-blue); border-radius: 50%; overflow: hidden; position: relative; z-index: 5; }
        .card-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .gold-name { color: var(--gold) !important; font-weight: bold; }

        /* Overlays */
        #loginOverlay { position: fixed; inset: 0; background: #080a12; z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .right-sidebar { background: #000; border-left: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; padding: 15px; }
        #chatBox { flex-grow: 1; overflow-y: auto; font-size: 0.8rem; }

        /* Wheel */
        .wheel-box { width: 280px; height: 280px; margin: 20px auto; position: relative; }
        #wheel { width: 100%; height: 100%; border-radius: 50%; border: 5px solid var(--ice-blue); position: relative; transition: transform 5s cubic-bezier(0.15, 0, 0.15, 1); background: conic-gradient(#0c1220 0 45deg, #1e293b 45deg 90deg, #0c1220 90deg 135deg, #1e293b 135deg 180deg, #0c1220 180deg 225deg, #1e293b 225deg 270deg, #0c1220 270deg 315deg, #1e293b 315deg 360deg); }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div style="text-align:center; border: 1px solid var(--ice-blue); padding: 30px; border-radius: 15px; width: 90%; max-width: 350px; background: #05050a;">
        <h2 style="font-family:'Cinzel'; color:var(--ice-blue);">WINTER LOUNGE</h2>
        <input id="regName" placeholder="Username" style="display:none;">
        <input id="authEmail" type="email" placeholder="Email">
        <input id="authPass" type="password" placeholder="Password">
        <button class="nav-btn" style="width:100%; margin-top: 10px;" onclick="handleAuth()">ENTER</button>
        <p onclick="toggleMode()" id="toggleText" style="font-size:0.7rem; cursor:pointer; color:#666; margin-top:15px;">Need an account? Register</p>
    </div>
</div>

<header>
    <div style="font-family:'Cinzel'; color:var(--ice-blue); letter-spacing:2px;">❄ DIAMOND LOUNGE</div>
    <div id="headerBalance" style="color:var(--ice-blue); font-weight:bold;">♦ 0</div>
</header>

<div id="mainView" class="main-layout" style="display:none">
    <nav class="nav-sidebar">
        <button class="nav-btn active" id="btn-explore" onclick="switchTab('explore')">Lounge</button>
        <button class="nav-btn" id="btn-wheel" onclick="switchTab('wheel')">Vault</button>
        <button class="nav-btn" id="btn-shop" onclick="switchTab('shop')">Shop</button>
        <button class="nav-btn" id="btn-inventory" onclick="switchTab('inventory')">Items</button>
        <button class="nav-btn" id="btn-profile" onclick="switchTab('profile')">Profile</button>
    </nav>

    <main id="centerContent">
        <section id="view-explore" class="view-section" style="display:block;"><div id="cardsContainer" class="card-grid"></div></section>
        
        <section id="view-wheel" class="view-section" style="text-align:center;">
            <div class="wheel-box"><div id="wheel"></div></div>
            <button class="nav-btn" id="spinBtn" onclick="spinWheel()">SPIN VAULT</button>
        </section>

        <section id="view-shop" class="view-section"><div id="shopContainer" class="card-grid"></div></section>
        <section id="view-inventory" class="view-section"><div id="inventoryContainer" class="card-grid"></div></section>
        
        <section id="view-profile" class="view-section">
            <h3>Identity Settings</h3>
            <input id="newAvatar" placeholder="Avatar Image URL">
            <input id="newBadge" placeholder="Custom Badge">
            <button class="nav-btn" onclick="updateProfile()">Save</button>
            <button class="nav-btn" style="color:red; margin-top:20px;" onclick="auth.signOut()">Logout</button>
        </section>
    </main>

    <aside class="right-sidebar">
        <div id="chatBox"></div>
        <input id="chatInput" placeholder="Chat..." onkeypress="if(event.key==='Enter') sendChat()">
    </aside>
</div>

<script>
// --- CONFIG ---
const firebaseConfig = {
    apiKey: "AIzaSyCDll8RH1kzGOf-ixJmSlHXGssOHSMlO3s",
    authDomain: "vibely-5128e.firebaseapp.com",
    projectId: "vibely-5128e",
    storageBucket: "vibely-5128e.firebasestorage.app",
    messagingSenderId: "1048550825812",
    appId: "1:1048550825812:web:fc5bbba51e065807ffb2c1"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore(), auth = firebase.auth();
let isLogin = true, myProfile = null, OWNER_UID = "pqPGbhBjvrVrgDrmUBa4J2ynmkW2";

// --- AUTH LOGIC ---
function toggleMode() {
    isLogin = !isLogin;
    document.getElementById('regName').style.display = isLogin ? 'none' : 'block';
    document.getElementById('toggleText').innerText = isLogin ? "Need an account? Register" : "Have an account? Login";
}

async function handleAuth() {
    const e = document.getElementById('authEmail').value, p = document.getElementById('authPass').value, n = document.getElementById('regName').value;
    try {
        if (isLogin) await auth.signInWithEmailAndPassword(e, p);
        else {
            const r = await auth.createUserWithEmailAndPassword(e, p);
            await db.collection('users').doc(r.user.uid).set({ name: n || "User", vibes: 50, xp: 0, inventory: {}, equipped: {} });
        }
    } catch (err) { alert(err.message); }
}

auth.onAuthStateChanged(user => {
    if (user) { document.getElementById('loginOverlay').style.display = 'none'; document.getElementById('mainView').style.display = 'grid'; loadApp(user.uid); }
    else { document.getElementById('loginOverlay').style.display = 'flex'; }
});

// --- SHOP DATA ---
const shopItems = [
    {id:'goldName', name:'Gold Name', cost:150, desc:'Elite Gold Text', effect:(eq)=>eq.nameStyle='gold'},
    {id:'aurora', name:'Aurora', cost:300, desc:'Legendary Glow', effect:(eq)=>eq.cardEffect='aurora'},
    {id:'blizzard', name:'Blizzard', cost:300, desc:'Winter Storm', effect:(eq)=>eq.cardEffect='blizzard'},
    {id:'glitch', name:'Glitch', cost:1000, desc:'Mythic Anomaly', effect:(eq)=>eq.cardEffect='glitch'},
    {id:'breath', name:'Frost Breath', cost:1000, desc:'Mythic Steam', effect:(eq)=>eq.cardEffect='breath'},
    {id:'supernova', name:'Supernova', cost:1000, desc:'Mythic Pulsar', effect:(eq)=>eq.cardEffect='supernova'}
];

function loadApp(uid) {
    db.collection('users').doc(uid).onSnapshot(d => { 
        if(d.exists) { myProfile = d.data(); document.getElementById('headerBalance').innerText = `♦ ${myProfile.vibes}`; loadInventory(); loadShop(); } 
    });
    db.collection('users').onSnapshot(snap => {
        const cont = document.getElementById('cardsContainer'); cont.innerHTML = '';
        snap.forEach(doc => {
            const u = doc.data();
            cont.innerHTML += `
                <div class="user-card ${u.equipped?.cardEffect || ''}-card">
                    <div class="card-avatar"><img src="${u.avatar || 'https://api.dicebear.com/7.x/bottts/svg?seed='+u.name}"></div>
                    <div class="${u.equipped?.nameStyle==='gold'?'gold-name':''}">${u.name}</div>
                    <div style="font-size:0.6rem; color:#888;">${u.equipped?.badge || ''}</div>
                    <div style="color:var(--gold);">♦ ${u.vibes}</div>
                </div>`;
        });
    });
}

function loadShop() {
    const cont = document.getElementById('shopContainer'); cont.innerHTML = '';
    shopItems.forEach(i => {
        cont.innerHTML += `<div class="shop-card" style="background:rgba(0,0,0,0.5); padding:15px; border-radius:10px; text-align:center;">
            <b>${i.name}</b><p style="font-size:0.7rem; color:#aaa;">${i.desc}</p>
            <button class="nav-btn" onclick="buyItem('${i.id}')">BUY ♦${i.cost}</button>
        </div>`;
    });
}

async function buyItem(id) {
    const item = shopItems.find(x => x.id === id);
    if (auth.currentUser.uid !== OWNER_UID && myProfile.vibes < item.cost) return alert("Insufficient Diamonds");
    let inv = myProfile.inventory || {}; inv[id] = true;
    await db.collection('users').doc(auth.currentUser.uid).update({
        vibes: auth.currentUser.uid === OWNER_UID ? myProfile.vibes : firebase.firestore.FieldValue.increment(-item.cost),
        inventory: inv
    });
}

function loadInventory() {
    const cont = document.getElementById('inventoryContainer'); if(!cont) return; cont.innerHTML = '';
    Object.keys(myProfile.inventory || {}).forEach(id => {
        const i = shopItems.find(x => x.id === id);
        cont.innerHTML += `<div class="shop-card" style="background:rgba(0,0,0,0.5); padding:15px; border-radius:10px; text-align:center;">
            <b>${i.name}</b><br><button class="nav-btn" onclick="equip('${id}')">EQUIP</button>
        </div>`;
    });
}

async function equip(id) {
    const item = shopItems.find(x => x.id === id);
    let eq = myProfile.equipped || {}; item.effect(eq);
    await db.collection('users').doc(auth.currentUser.uid).update({ equipped: eq });
}

function switchTab(t) {
    document.querySelectorAll('.view-section').forEach(v => v.style.display='none');
    document.getElementById('view-'+t).style.display='block';
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('btn-'+t).classList.add('active');
}

// --- VAULT ---
async function spinWheel() {
    const btn = document.getElementById('spinBtn'); btn.disabled = true;
    const deg = 3600 + Math.floor(Math.random() * 360);
    document.getElementById('wheel').style.transform = `rotate(${deg}deg)`;
    setTimeout(async () => {
        await db.collection('users').doc(auth.currentUser.uid).update({ vibes: firebase.firestore.FieldValue.increment(10) });
        btn.disabled = false; alert("You found ♦10!");
    }, 5100);
}

// --- PROFILE ---
async function updateProfile() {
    const av = document.getElementById('newAvatar').value, bd = document.getElementById('newBadge').value;
    let eq = myProfile.equipped || {}; if(bd) eq.badge = bd;
    await db.collection('users').doc(auth.currentUser.uid).update({ avatar: av, equipped: eq });
}
</script>
</body>
</html>
