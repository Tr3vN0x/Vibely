<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibely | Professional</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #a855f7;
            --primary-glow: rgba(168, 85, 247, 0.4);
            --bg: #09090b;
            --surface: #18181b;
            --border: #27272a;
            --text-dim: #a1a1aa;
            --gold: #fbbf24;
        }

        body { background: var(--bg); color: #fff; font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .hidden { display: none !important; }

        /* Navigation Sidebar */
        .sidebar { width: 260px; border-right: 1px solid var(--border); padding: 2rem 1rem; display: flex; flex-direction: column; gap: 0.5rem; }
        .logo { font-size: 1.8rem; font-weight: 800; color: var(--primary); margin-bottom: 2rem; padding-left: 1rem; }
        .nav-item { padding: 12px 16px; border-radius: 12px; color: var(--text-dim); text-decoration: none; font-weight: 600; display: flex; align-items: center; gap: 12px; transition: 0.2s; cursor: pointer; }
        .nav-item:hover, .nav-item.active { background: var(--surface); color: #fff; }
        .nav-item.active { color: var(--primary); border-left: 4px solid var(--primary); border-radius: 4px 12px 12px 4px; }

        /* Main Content */
        .main-viewport { flex: 1; overflow-y: auto; padding: 2rem; display: flex; flex-direction: column; align-items: center; }
        .page-content { width: 100%; max-width: 650px; }

        /* Cards & UI */
        .glass-card { background: var(--surface); border: 1px solid var(--border); border-radius: 20px; padding: 20px; margin-bottom: 1.5rem; box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
        .btn-vibe { background: var(--primary); color: white; border: none; padding: 10px 24px; border-radius: 99px; font-weight: 700; cursor: pointer; transition: 0.2s; }
        .btn-vibe:hover { transform: translateY(-2px); box-shadow: 0 0 15px var(--primary-glow); }

        /* Explore Grid */
        .explore-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        .trending-tag { background: #27272a; padding: 15px; border-radius: 15px; text-align: center; border: 1px solid var(--border); }

        /* Badges */
        .badge-owner { color: var(--gold); text-shadow: 0 0 8px rgba(251, 191, 36, 0.5); margin-left: 5px; }
        .badge-verified { color: #38bdf8; margin-left: 5px; }

        .post-author { font-weight: 800; font-size: 1rem; display: flex; align-items: center; }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="logo"><i class="fas fa-skull"></i> VIBELY</div>
        <div class="nav-item active" onclick="navigate('feed', this)"><i class="fas fa-home"></i> Feed</div>
        <div class="nav-item" onclick="navigate('explore', this)"><i class="fas fa-hashtag"></i> Explore</div>
        <div class="nav-item" onclick="navigate('notifs', this)"><i class="fas fa-heart"></i> Activity</div>
        <div class="nav-item" onclick="navigate('profile', this)"><i class="fas fa-user-circle"></i> Profile</div>
        <div class="nav-item" style="margin-top:auto; color:#ff4444" onclick="handleLogout()"><i class="fas fa-power-off"></i> Exit</div>
    </aside>

    <main class="main-viewport">
        <div id="page-feed" class="page-content">
            <div class="glass-card">
                <textarea id="post-input" style="width:100%; background:transparent; border:none; color:#fff; font-size:1.2rem; outline:none; resize:none;" placeholder="What's the vibe?"></textarea>
                <div style="text-align:right; margin-top:10px;"><button class="btn-vibe" onclick="sendPost()">Vibe</button></div>
            </div>
            <div id="posts-container"></div>
        </div>

        <div id="page-explore" class="page-content hidden">
            <h2>Trending Now</h2>
            <div class="explore-grid">
                <div class="trending-tag">#CyberPunk2026</div>
                <div class="trending-tag">#VibelyElite</div>
                <div class="trending-tag">#CodingSkull</div>
                <div class="trending-tag">#PurpleVibe</div>
            </div>
        </div>

        <div id="page-notifs" class="page-content hidden">
            <h2>Activity</h2>
            <div class="glass-card">No new notifications. Start vibing!</div>
        </div>

        <div id="page-profile" class="page-content hidden">
            <div class="glass-card" style="text-align:center;">
                <div style="width:100px; height:100px; background:var(--primary); border-radius:30px; margin: 0 auto 15px; display:grid; place-items:center; font-size:2.5rem;">
                    <i class="fas fa-ghost"></i>
                </div>
                <h1 id="my-name">User</h1>
                <p id="my-stats" style="color:var(--text-dim)">0 Following Â· 0 Followers</p>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCDll8RH1kzGOf-ixJmSlHXGssOHSMlO3s",
            authDomain: "vibely-5128e.firebaseapp.com",
            projectId: "vibely-5128e",
            storageBucket: "vibely-5128e.firebasestorage.app",
            messagingSenderId: "1048550825812",
            appId: "1:1048550825812:web:fc5bbba51e065807ffb2c1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const OWNER_UID = "pqPGbhBjvrVrgDrmUBa4J2ynmkW2";

        // Navigation Engine
        window.navigate = (pageId, el) => {
            document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
            document.getElementById('page-' + pageId).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
        };

        // Real-time Feed with Badge Logic
        function initFeed() {
            const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
            onSnapshot(q, (snap) => {
                const container = document.getElementById('posts-container');
                container.innerHTML = "";
                snap.forEach(async (d) => {
                    const post = d.data();
                    let badge = "";
                    
                    // Owner Badge
                    if (post.uid === OWNER_UID) {
                        badge = `<i class="fas fa-crown badge-owner" title="Owner"></i>`;
                    } 
                    // Follower Badge (10K+)
                    else if (post.followerCount >= 10000) {
                        badge = `<i class="fas fa-check-circle badge-verified" title="Elite"></i>`;
                    }

                    container.innerHTML += `
                        <div class="glass-card">
                            <div class="post-author">@${post.author} ${badge}</div>
                            <p style="margin-top:10px; line-height:1.5;">${post.text}</p>
                        </div>
                    `;
                });
            });
        }

        // Post Logic
        window.sendPost = async () => {
            const input = document.getElementById('post-input');
            if(!input.value.trim()) return;

            // Fetch current user stats for the badge logic
            const userRef = doc(db, "users", auth.currentUser.uid);
            const userSnap = await getDoc(userRef);
            const followers = userSnap.exists() ? userSnap.data().followerCount || 0 : 0;

            await addDoc(collection(db, "posts"), {
                text: input.value,
                uid: auth.currentUser.uid,
                author: auth.currentUser.displayName,
                followerCount: followers,
                createdAt: serverTimestamp()
            });
            input.value = "";
        };

        onAuthStateChanged(auth, (user) => {
            if(user) {
                document.getElementById('my-name').innerText = user.displayName;
                initFeed();
            } else {
                window.location.href = "login.html"; // Or show auth modal
            }
        });

        window.handleLogout = () => signOut(auth);
    </script>
</body>
</html>
