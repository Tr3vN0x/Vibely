<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vibely ‚ùÑÔ∏è Winter Casino</title>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet" />

  <style>
    :root {
      --ice: #38bdf8;
      --gold: #facc15;
      --bg: #020617;
      --card: rgba(15, 23, 42, 0.75);
      --border: rgba(255, 255, 255, 0.1);
    }

    * { box-sizing: border-box; transition: 0.25s ease; }
    body {
      margin: 0;
      font-family: 'Plus Jakarta Sans', sans-serif;
      background: radial-gradient(circle at top, #0f172a, #020617);
      color: #f8fafc;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    header {
      padding: 1rem 2rem;
      background: rgba(0,0,0,0.7);
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border);
      z-index: 10;
    }

    .layout {
      display: grid;
      grid-template-columns: 240px 1fr 320px;
      flex: 1;
      overflow: hidden;
    }

    nav {
      padding: 2rem 1.5rem;
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .nav-link {
      padding: 0.9rem 1rem;
      border-radius: 14px;
      font-size: 0.75rem;
      font-weight: 800;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: #64748b;
      cursor: pointer;
    }

    .nav-link.active, .nav-link:hover {
      background: var(--card);
      color: var(--ice);
      border: 1px solid var(--border);
    }

    main { padding: 2.5rem; overflow-y: auto; }
    .view { display: none; animation: fade 0.4s ease; }
    @keyframes fade { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 1.5rem; }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 22px;
      padding: 1.8rem;
      text-align: center;
      backdrop-filter: blur(12px);
    }

    .card:hover { transform: translateY(-4px); border-color: var(--ice); }

    .avatar {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--ice);
      margin-bottom: 0.8rem;
    }

    .btn {
      width: 100%;
      padding: 12px;
      margin-top: 1rem;
      background: var(--ice);
      color: #000;
      font-weight: 800;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      text-transform: uppercase;
      font-size: 0.7rem;
    }

    .btn:disabled { background: #1e293b; color: #64748b; cursor: not-allowed; }

    aside {
      border-left: 1px solid var(--border);
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      background: rgba(0,0,0,0.3);
    }

    .chat { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 0.8rem; }
    .msg { background: var(--card); padding: 10px; border-radius: 14px; font-size: 0.8rem; border: 1px solid var(--border); }
    .msg b { color: var(--ice); display: block; font-size: 0.65rem; }

    input, textarea {
      width: 100%;
      padding: 12px;
      margin-top: 0.6rem;
      background: #0f172a;
      border: 1px solid var(--border);
      color: #fff;
      border-radius: 12px;
      outline: none;
      resize: none;
    }

    .wheel-container { position: relative; width: 300px; margin: 2rem auto; }
    .wheel {
      width: 300px;
      height: 300px;
      border-radius: 50%;
      border: 10px solid #1e293b;
      background: conic-gradient(
        #0f172a 0 45deg, #1e293b 45 90deg,
        #0f172a 90 135deg, #1e293b 135 180deg,
        #0f172a 180 225deg, #1e293b 225 270deg,
        #0f172a 270 315deg, var(--gold) 315 360deg
      );
      transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1);
    }

    .needle {
      position: absolute;
      top: -10px; left: 50%;
      transform: translateX(-50%);
      width: 0; height: 0;
      border-left: 14px solid transparent;
      border-right: 14px solid transparent;
      border-top: 26px solid var(--ice);
      z-index: 5;
      filter: drop-shadow(0 0 6px var(--ice));
    }
  </style>
</head>
<body>

<header>
  <div style="font-family:Cinzel; color:var(--ice); letter-spacing:3px;">VIBELY ‚ùÑÔ∏è</div>
  <div id="stats">‚ô¶ 0 ¬∑ LVL 1</div>
</header>

<div class="layout">
  <nav>
    <div class="nav-link active" onclick="nav('lounge', this)">Lounge</div>
    <div class="nav-link" onclick="nav('wheel', this)">Spin</div>
    <div class="nav-link" onclick="nav('shop', this)">Shop</div>
    <div class="nav-link" onclick="nav('profile', this)">Profile</div>
  </nav>

  <main>
    <section id="view-lounge" class="view" style="display:block;">
      <h2>Players</h2>
      <div id="players" class="grid"></div>
    </section>

    <section id="view-wheel" class="view">
      <h2>Daily Spin</h2>
      <div class="wheel-container">
        <div class="needle"></div>
        <div id="wheel" class="wheel"></div>
      </div>
      <button id="spinBtn" class="btn" onclick="spin()">Spin</button>
      <div id="spinMsg" style="margin-top:1rem; text-align: center; color: var(--gold); font-weight: bold;"></div>
    </section>

    <section id="view-shop" class="view">
      <h2>Avatar Shop</h2>
      <div id="shop" class="grid">
        <div class="card">Coming Soon...</div>
      </div>
    </section>

    <section id="view-profile" class="view">
      <h2>My Profile</h2>
      <div class="card" style="max-width: 400px; margin: auto;">
        <img id="myAvatar" class="avatar" src="https://placehold.co/200x200" />
        <input id="avatarUrl" placeholder="Profile image URL" />
        <textarea id="bio" placeholder="Your bio / tags"></textarea>
        <button class="btn" onclick="saveProfile()">Save Profile</button>
      </div>
    </section>
  </main>

  <aside>
    <div id="chat" class="chat"></div>
    <input id="chatInput" placeholder="Message..." onkeypress="if(event.key==='Enter') send()" />
  </aside>
</div>

<script>
// üî• RE-INSERT YOUR CONFIG HERE
const firebaseConfig = { /* your config */ };

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

let me = null;
let currentRotation = 0;

auth.signInAnonymously();

auth.onAuthStateChanged(async u => {
  if (!u) return;
  const ref = db.collection('users').doc(u.uid);
  const doc = await ref.get();
  if (!doc.exists) {
    await ref.set({
      name: 'Guest_' + Math.floor(Math.random()*999),
      avatar: 'https://api.dicebear.com/7.x/pixel-art/svg?seed=' + u.uid,
      bio: '',
      diamonds: 100,
      xp: 0,
      lastSpin: 0
    });
  }

  ref.onSnapshot(s => { 
    me = s.data(); 
    updateUI(); 
  });
});

function updateUI() {
  if(!me) return;
  document.getElementById('stats').innerText = `‚ô¶ ${me.diamonds} ¬∑ LVL ${Math.floor(me.xp/100)+1}`;
  document.getElementById('myAvatar').src = me.avatar;
  document.getElementById('bio').value = me.bio || '';
}

function nav(v, el) {
  document.querySelectorAll('.view').forEach(s => s.style.display='none');
  document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
  document.getElementById('view-'+v).style.display='block';
  el.classList.add('active');
}

function saveProfile() {
  const newUrl = document.getElementById('avatarUrl').value;
  db.collection('users').doc(auth.currentUser.uid).update({
    avatar: newUrl || me.avatar,
    bio: document.getElementById('bio').value
  }).then(() => alert("Profile Saved!"));
}

function spin() {
  const btn = document.getElementById('spinBtn');
  const wheel = document.getElementById('wheel');
  const msg = document.getElementById('spinMsg');
  
  btn.disabled = true;
  msg.innerText = "Spinning...";
  
  // Logic: 5 full spins + random degrees
  const extraDegrees = Math.floor(Math.random() * 360);
  currentRotation += (360 * 5) + extraDegrees;
  wheel.style.transform = `rotate(${currentRotation}deg)`;

  setTimeout(() => {
    const rewards = [10, 20, 50, 'xp', 'xp', 100];
    const r = rewards[Math.floor(Math.random()*rewards.length)];
    
    if (r === 'xp') {
      db.collection('users').doc(auth.currentUser.uid).update({ 
        xp: firebase.firestore.FieldValue.increment(40) 
      });
      msg.innerText = 'You won 40 XP!';
    } else {
      db.collection('users').doc(auth.currentUser.uid).update({ 
        diamonds: firebase.firestore.FieldValue.increment(r) 
      });
      msg.innerText = `You won ‚ô¶ ${r}`;
    }
    btn.disabled = false;
  }, 4000);
}

function send() {
  const input = document.getElementById('chatInput');
  const val = input.value.trim();
  if (!val || !me) return;
  
  db.collection('chat').add({ 
    name: me.name, 
    msg: val, 
    time: Date.now() 
  });
  
  db.collection('users').doc(auth.currentUser.uid).update({ 
    xp: firebase.firestore.FieldValue.increment(5) 
  });
  input.value='';
}

// Fixed Chat Listener (Auto-Scroll)
db.collection('chat').orderBy('time', 'desc').limit(30).onSnapshot(s => {
  const chatDiv = document.getElementById('chat');
  chatDiv.innerHTML='';
  const messages = [];
  s.forEach(d => messages.unshift(d.data()));
  messages.forEach(m => {
    chatDiv.innerHTML += `<div class="msg"><b>${m.name}</b>${m.msg}</div>`;
  });
  chatDiv.scrollTop = chatDiv.scrollHeight;
});

// Fixed Player Grid Listener
db.collection('users').onSnapshot(s => {
  const playerDiv = document.getElementById('players');
  playerDiv.innerHTML='';
  s.forEach(d => {
    const u = d.data();
    playerDiv.innerHTML += `
      <div class="card">
        <img class="avatar" src="${u.avatar}">
        <div style="font-weight:800;">${u.name}</div>
        <p style="font-size:0.7rem; color: #64748b;">${u.bio||''}</p>
      </div>`;
  });
});
</script>
</body>
</html>
