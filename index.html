<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibely | Winter Diamond Lounge</title>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        :root { --gold: #d4af37; --ice-blue: #a5f3fc; --obsidian: #05050a; --glass: rgba(255, 255, 255, 0.05); }
        * { box-sizing: border-box; transition: all 0.3s ease; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: #080a12; color: #fff; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* General UI Styles */
        header { padding: 15px 40px; background: rgba(5, 5, 10, 0.95); border-bottom: 1px solid rgba(165, 243, 252, 0.2); display: flex; justify-content: space-between; align-items: center; z-index:10; }
        .main-layout { display: grid; grid-template-columns: 240px 1fr 320px; flex-grow: 1; overflow: hidden; position: relative; }
        .nav-sidebar { padding: 25px 15px; background: rgba(0,0,0,0.5); border-right: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; gap: 10px; backdrop-filter: blur(8px); }
        .nav-btn { background: var(--glass); border: 1px solid transparent; color: #aaa; padding: 12px 20px; font-family: 'Cinzel', serif; cursor: pointer; border-radius: 4px; font-size: 0.8rem; }
        .nav-btn:hover, .nav-btn.active { color: var(--ice-blue); border-color: var(--ice-blue); background: rgba(165, 243, 252, 0.1); box-shadow: 0 0 10px var(--ice-blue); }
        #centerContent { overflow-y: auto; padding: 40px; background: radial-gradient(circle at top, #0c1220 0%, #05050a 100%); position: relative; }
        .view-section { display: none; max-width: 900px; margin: 0 auto; }

        /* --- CARD SYSTEM --- */
        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px; }
        .user-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(165, 243, 252, 0.2); border-radius: 12px; padding: 25px; text-align: center; position: relative; animation: cardEnter 0.6s forwards; opacity: 0; overflow: hidden; }
        
        /* Mythic Classes (1000 Diamonds) */
        .glitch-card { border: 2px solid #00f2ff !important; animation: glitchShake 0.4s infinite; background: #000 !important; }
        .breath-card { background: linear-gradient(to top, #0c1220, #2c3e50) !important; border: 2px solid #fff !important; }
        .breath-card::after { content: '☁'; position: absolute; bottom: -10px; left: 50%; font-size: 50px; filter: blur(15px); opacity: 0.5; animation: steamRise 2s infinite ease-out; pointer-events: none; }
        .supernova-card { background: #000 !important; border: 2px solid var(--gold) !important; }
        .supernova-card::before { content: ''; position: absolute; top: 50%; left: 50%; width: 150%; height: 150%; background: conic-gradient(from 0deg, transparent, var(--ice-blue), transparent 20%); animation: rotateSupernova 4s linear infinite; transform: translate(-50%, -50%); z-index: 0; pointer-events: none; }

        /* Legendary Classes (300 Diamonds) */
        .blizzard-card { background: linear-gradient(225deg, #1e293b, #0f172a) !important; border: 2px solid #fff !important; box-shadow: 0 0 25px #fff, inset 0 0 20px rgba(255,255,255,0.3) !important; }
        .aurora-card { background: linear-gradient(135deg, #0f172a, #05050a) !important; border: 2px solid #4ade80 !important; }
        .aurora-card::before { content: ''; position: absolute; inset: 0; background: linear-gradient(45deg, #4ade80, #3b82f6, #a855f7, #4ade80); background-size: 400% 400%; z-index: -1; opacity: 0.3; animation: auroraFlow 6s ease infinite; }

        @keyframes glitchShake { 0% { transform: translate(0); } 20% { transform: translate(-2px, 2px); } 40% { transform: translate(-2px, -2px); filter: hue-rotate(90deg); } 60% { transform: translate(2px, 2px); } 80% { transform: translate(2px, -2px); } 100% { transform: translate(0); } }
        @keyframes steamRise { 0% { transform: translateX(-50%) translateY(0) scale(0.5); opacity: 0; } 50% { opacity: 0.6; } 100% { transform: translateX(-50%) translateY(-100px) scale(2); opacity: 0; } }
        @keyframes rotateSupernova { from { transform: translate(-50%, -50%) rotate(0deg); } to { transform: translate(-50%, -50%) rotate(360deg); } }
        @keyframes auroraFlow { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes cardEnter { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .card-avatar { width: 80px; height: 80px; margin: 0 auto 10px; border: 2px solid var(--ice-blue); border-radius: 50%; overflow: hidden; position: relative; z-index: 5; }
        .card-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .gold-name { color: var(--gold) !important; font-weight: bold; text-shadow: 0 0 8px rgba(212,175,55,0.4); }
        .card-xp { background: rgba(165,243,252,0.1); border-radius: 8px; height: 6px; width: 100%; margin-top: 5px; overflow: hidden; }
        .card-xp-fill { background: var(--ice-blue); width: 0%; height: 100%; }

        /* Login & Overlays */
        #loginOverlay { position: fixed; inset: 0; background: #080a12; z-index: 1000; display: flex; align-items: center; justify-content: center; }
        input { background: #111; border: 1px solid #333; color: #fff; padding: 10px; margin: 10px 0; width: 100%; border-radius: 5px; outline: none; }
        .shop-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .shop-card { background: rgba(0,0,0,0.6); border: 1px solid rgba(165, 243, 252, 0.2); border-radius:12px; padding:20px; text-align:center; }
        
        /* Wheel */
        .wheel-box { position: relative; width: 320px; height: 320px; margin: 20px auto; }
        #wheel { width: 100%; height: 100%; border-radius: 50%; border: 8px solid var(--ice-blue); position: relative; background: conic-gradient(#0c1220 0 45deg, #1e293b 45deg 90deg, #0c1220 90deg 135deg, #1e293b 135deg 180deg, #0c1220 180deg 225deg, #1e293b 225deg 270deg, #0c1220 270deg 315deg, #1e293b 315deg 360deg); transition: transform 5s cubic-bezier(0.15, 0, 0.15, 1); }
        .wheel-segment { position: absolute; width: 100%; height: 100%; text-align: center; padding-top: 20px; font-weight: bold; font-size: 0.7rem; color: var(--ice-blue); font-family: 'Cinzel'; }

        /* Chat */
        .right-sidebar { background: #000; border-left: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; padding: 15px; }
        #chatBox { flex-grow: 1; overflow-y: auto; font-size: 0.8rem; }
        .chat-msg { margin-bottom: 8px; padding: 8px; background: rgba(165, 243, 252, 0.05); border-radius: 8px; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div style="text-align:center; border: 1px solid var(--ice-blue); padding: 40px; border-radius: 15px; width: 350px; background: #05050a;">
        <h2 style="font-family:'Cinzel'; color:var(--ice-blue);">WINTER LOUNGE</h2>
        <input id="regName" placeholder="Username" style="display:none;">
        <input id="authEmail" type="email" placeholder="Email">
        <input id="authPass" type="password" placeholder="Password">
        <button class="nav-btn" style="width:100%; margin-top: 10px;" onclick="handleAuth()">ENTER</button>
        <p onclick="toggleMode()" style="font-size:0.7rem; cursor:pointer; color:#666; margin-top:15px;">Switch Mode</p>
    </div>
</div>

<header>
    <div style="font-family:'Cinzel'; color:var(--ice-blue); letter-spacing:5px;">❄ DIAMOND LOUNGE</div>
    <div id="headerBalance" style="color:var(--ice-blue); font-weight:bold;">♦ 0</div>
</header>

<div id="mainView" class="main-layout" style="display:none">
    <nav class="nav-sidebar">
        <button class="nav-btn active" id="btn-explore" onclick="switchTab('explore')">Lounge</button>
        <button class="nav-btn" id="btn-wheel" onclick="switchTab('wheel')">Frost Vault</button>
        <button class="nav-btn" id="btn-profile" onclick="switchTab('profile')">Identity</button>
        <button class="nav-btn" id="btn-shop" onclick="switchTab('shop')">Shop</button>
        <button class="nav-btn" id="btn-inventory" onclick="switchTab('inventory')">Inventory</button>
        <button class="nav-btn" style="margin-top:auto; color:crimson;" onclick="auth.signOut()">Logout</button>
    </nav>

    <main id="centerContent">
        <section id="view-explore" class="view-section" style="display:block;"><div id="cardsContainer" class="card-grid"></div></section>
        <section id="view-wheel" class="view-section" style="text-align:center;">
            <div class="wheel-box"><div id="wheel">
                <div class="wheel-segment" style="transform:rotate(0deg)">♦ 5</div>
                <div class="wheel-segment" style="transform:rotate(45deg)">+50 XP</div>
                <div class="wheel-segment" style="transform:rotate(135deg)">JACKPOT</div>
                <div class="wheel-segment" style="transform:rotate(270deg)">♦ 25</div>
            </div></div>
            <button class="nav-btn" id="spinBtn" onclick="spinWheel()">ACTIVATE VAULT</button>
        </section>
        <section id="view-shop" class="view-section"><div id="shopContainer" class="shop-grid"></div></section>
        <section id="view-inventory" class="view-section"><div id="inventoryContainer" class="shop-grid"></div></section>
        <section id="view-profile" class="view-section">
            <input id="newAvatar" placeholder="Avatar URL"><input id="newBadge" placeholder="Custom Badge">
            <button class="nav-btn" onclick="updateProfile()">Save Identity</button>
        </section>
    </main>

    <aside class="right-sidebar"><div id="chatBox"></div><input id="chatInput" placeholder="Chat..." onkeypress="if(event.key==='Enter') sendChat()"></aside>
</div>

<script>
// --- FIREBASE CONFIG ---
const firebaseConfig = {
    apiKey: "AIzaSyCDll8RH1kzGOf-ixJmSlHXGssOHSMlO3s",
    authDomain: "vibely-5128e.firebaseapp.com",
    projectId: "vibely-5128e",
    storageBucket: "vibely-5128e.firebasestorage.app",
    messagingSenderId: "1048550825812",
    appId: "1:1048550825812:web:fc5bbba51e065807ffb2c1"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore(), auth = firebase.auth();
let isLogin = true, myProfile = null, OWNER_UID = "pqPGbhBjvrVrgDrmUBa4J2ynmkW2";

// --- SHOP ITEMS (MYTHIC ADDED) ---
const shopItems = [
    {id:'shimmerXP', name:'Shimmer XP', cost:40, desc:'Glow bar', effect:(eq)=>eq.xpBar='shimmer'},
    {id:'goldName', name:'Gilded Name', cost:150, desc:'Gold text', effect:(eq)=>eq.nameStyle='gold'},
    {id:'aurora', name:'Aurora (LEGENDARY)', cost:300, desc:'Flowing neon lights', effect:(eq)=>eq.cardEffect='aurora'},
    {id:'blizzard', name:'Blizzard (LEGENDARY)', cost:300, desc:'Winter storm', effect:(eq)=>eq.cardEffect='blizzard'},
    // MYTHICS
    {id:'glitch', name:'Glitch (MYTHIC)', cost:1000, desc:'Cyber-winter anomaly', effect:(eq)=>eq.cardEffect='glitch'},
    {id:'breath', name:'Frost Breath (MYTHIC)', cost:1000, desc:'Rising freezing steam', effect:(eq)=>eq.cardEffect='breath'},
    {id:'supernova', name:'Supernova (MYTHIC)', cost:1000, desc:'Pulsing core energy', effect:(eq)=>eq.cardEffect='supernova'}
];

// --- CORE LOGIC ---
auth.onAuthStateChanged(user => {
    if (user) { document.getElementById('loginOverlay').style.display = 'none'; document.getElementById('mainView').style.display = 'grid'; loadApp(user.uid); loadShop(); }
    else { document.getElementById('loginOverlay').style.display = 'flex'; }
});

function loadApp(uid) {
    db.collection('users').doc(uid).onSnapshot(d => { if(d.exists) { myProfile = d.data(); document.getElementById('headerBalance').innerText = `♦ ${myProfile.vibes}`; loadInventory(); } });
    db.collection('users').onSnapshot(snap => {
        const cont = document.getElementById('cardsContainer'); cont.innerHTML = '';
        snap.forEach(doc => {
            const u = doc.data(); const xpP = (u.xp || 0) % 100;
            let eff = u.equipped?.cardEffect || "";
            cont.innerHTML += `
                <div class="user-card ${eff}-card">
                    <div class="card-avatar"><img src="${u.avatar || 'https://api.dicebear.com/7.x/bottts/svg?seed='+u.name}"></div>
                    <div class="${u.equipped?.nameStyle==='gold'?'gold-name':''}" style="position:relative; z-index:5;">${u.name}</div>
                    <div style="font-size:0.6rem; color:#888; position:relative; z-index:5;">${u.equipped?.badge || u.badge || ''}</div>
                    <div style="color:var(--gold); position:relative; z-index:5;">♦ ${u.vibes}</div>
                    <div class="card-xp" style="position:relative; z-index:5;"><div class="card-xp-fill" style="width:${xpP}%;"></div></div>
                </div>`;
        });
    });
}

async function buyItem(id) {
    const item = shopItems.find(i => i.id === id);
    if (auth.currentUser.uid !== OWNER_UID && myProfile.vibes < item.cost) return alert("Not enough Diamonds!");
    let inv = myProfile.inventory || {}; inv[id] = true;
    await db.collection('users').doc(auth.currentUser.uid).update({ vibes: auth.currentUser.uid === OWNER_UID ? myProfile.vibes : firebase.firestore.FieldValue.increment(-item.cost), inventory: inv });
}

function loadShop() {
    const cont = document.getElementById('shopContainer'); cont.innerHTML = '';
    shopItems.forEach(i => { cont.innerHTML += `<div class="shop-card"><b>${i.name}</b><p>${i.desc}</p><p>♦ ${i.cost}</p><button class="nav-btn" onclick="buyItem('${i.id}')">BUY</button></div>`; });
}

function loadInventory() {
    const cont = document.getElementById('inventoryContainer'); if (!cont) return; cont.innerHTML = '';
    Object.keys(myProfile.inventory || {}).forEach(id => { const i = shopItems.find(x => x.id === id); if(i) cont.innerHTML += `<div class="shop-card"><b>${i.name}</b><button class="nav-btn" onclick="equip('${id}')">EQUIP</button></div>`; });
}

async function equip(id) { const i = shopItems.find(x => x.id === id); let eq = myProfile.equipped || {}; i.effect(eq); await db.collection('users').doc(auth.currentUser.uid).update({ equipped: eq }); }

// --- VAULT & CHAT (Simplified for brevity) ---
async function spinWheel() {
    const btn = document.getElementById('spinBtn'); btn.disabled = true;
    const index = Math.floor(Math.random() * 8);
    document.getElementById('wheel').style.transform = `rotate(${3600 + (index * 45)}deg)`;
    setTimeout(async () => {
        const rewards = [{v:5},{x:50},{v:10},{v:100, j:true},{v:1},{x:10},{v:25},{v:0}];
        const win = rewards[index];
        await db.collection('users').doc(auth.currentUser.uid).update({ vibes: firebase.firestore.FieldValue.increment(win.v || 0), xp: firebase.firestore.FieldValue.increment(win.x || 0), lastSpin: firebase.firestore.FieldValue.serverTimestamp() });
        btn.disabled = false;
    }, 5500);
}

function handleAuth() { /* Same as previous logic */ }
function toggleMode() { /* Same as previous logic */ }
function switchTab(t) { document.querySelectorAll('.view-section').forEach(v => v.style.display='none'); document.getElementById('view-'+t).style.display='block'; }
</script>
</body>
</html>
