    <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibely | Winter Diamond Lounge</title>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --gold: #d4af37;
            --ice-blue: #a5f3fc;
            --obsidian: #05050a;
            --glass: rgba(255, 255, 255, 0.05);
        }

        * { box-sizing: border-box; transition: all 0.3s ease; }
        body { 
            margin: 0; font-family: 'Inter', sans-serif; background: #080a12; color: #fff; height: 100vh; overflow: hidden; display: flex; flex-direction: column;
        }

        /* Snow & Sparkles */
        .snowflake { 
            color: #a5f3fc; text-shadow: 0 0 8px #a5f3fc, 0 0 12px #fff; position: fixed; top: -10%; z-index: 999; animation: fall linear infinite, sway 3s ease-in-out infinite alternate; pointer-events: none; opacity: 0.8; 
        }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }
        @keyframes sway { 0% { transform: translateX(0) rotate(0deg); } 100% { transform: translateX(20px) rotate(45deg); } }

        /* UI Shell */
        header { padding: 15px 40px; background: rgba(5, 5, 10, 0.95); border-bottom: 1px solid rgba(165, 243, 252, 0.2); display: flex; justify-content: space-between; align-items: center; z-index:10; }
        .main-layout { display: grid; grid-template-columns: 240px 1fr 320px; flex-grow: 1; overflow: hidden; position: relative; }
        .nav-sidebar { padding: 25px 15px; background: rgba(0,0,0,0.5); border-right: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; gap: 10px; backdrop-filter: blur(8px); }
        .nav-btn { background: var(--glass); border: 1px solid transparent; color: #aaa; padding: 12px 20px; font-family: 'Cinzel', serif; cursor: pointer; border-radius: 4px; font-size: 0.8rem; }
        .nav-btn:hover, .nav-btn.active { color: var(--ice-blue); border-color: var(--ice-blue); background: rgba(165, 243, 252, 0.1); box-shadow: 0 0 10px var(--ice-blue); }

        #centerContent { overflow-y: auto; padding: 40px; background: radial-gradient(circle at top, #0c1220 0%, #05050a 100%); position: relative; }
        .view-section { display: none; max-width: 900px; margin: 0 auto; }

        /* Wheel */
        .wheel-box { position: relative; width: 320px; height: 320px; margin: 20px auto; }
        #wheel { width: 100%; height: 100%; border-radius: 50%; border: 8px solid var(--ice-blue); position: relative; background: conic-gradient(#0c1220 0 45deg, #1e293b 45deg 90deg, #0c1220 90deg 135deg, #1e293b 135deg 180deg, #0c1220 180deg 225deg, #1e293b 225deg 270deg, #0c1220 270deg 315deg, #1e293b 315deg 360deg); transition: transform 5s cubic-bezier(0.15, 0, 0.15, 1); box-shadow: 0 0 20px rgba(165,243,252,0.4); }
        .wheel-segment { position: absolute; width: 100%; height: 100%; text-align: center; padding-top: 20px; font-weight: bold; font-size: 0.7rem; color: var(--ice-blue); font-family: 'Cinzel'; text-shadow: 0 0 5px #a5f3fc; }

        /* User Cards */
        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px; }
        .user-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(165, 243, 252, 0.2); border-radius: 12px; padding: 25px; text-align: center; position: relative; animation: cardEnter 0.6s forwards; opacity: 0; }
        @keyframes cardEnter { to { opacity: 1; transform: translateY(0); } }

        .card-avatar { width: 80px; height: 80px; margin: 0 auto 10px; border: 2px solid var(--ice-blue); border-radius: 50%; overflow: hidden; }
        .card-avatar img { width: 100%; height: 100%; object-fit: cover; }

        /* Special Effects */
        .gold-name { color: var(--gold) !important; font-weight: bold; text-shadow: 0 0 8px rgba(212,175,55,0.4); }
        .shimmer-bar { background: linear-gradient(90deg, #a5f3fc, #fff, #a5f3fc); background-size: 200%; animation: shimmer 2s linear infinite; }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        
        .card-xp { background: rgba(165,243,252,0.1); border-radius: 8px; height: 6px; width: 100%; margin-top: 5px; overflow: hidden; }
        .card-xp-fill { background: var(--ice-blue); width: 0%; height: 100%; transition: width 1s ease-in-out; }

        /* UI Overlays */
        #loginOverlay { position: fixed; inset: 0; background: #080a12; z-index: 1000; display: flex; align-items: center; justify-content: center; }
        input { background: #111; border: 1px solid #333; color: #fff; padding: 10px; margin: 10px 0; width: 100%; border-radius: 5px; outline: none; }
        .shop-grid, .inventory-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .shop-card, .inventory-card { background: rgba(0,0,0,0.6); border: 1px solid rgba(165,243,252,0.2); border-radius:12px; padding:20px; text-align:center; }
        
        /* Chat */
        .right-sidebar { background: #000; border-left: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; padding: 15px; }
        #chatBox { flex-grow: 1; overflow-y: auto; font-size: 0.8rem; padding-bottom: 10px; }
        .chat-msg { margin-bottom: 8px; padding: 8px; background: rgba(165, 243, 252, 0.05); border-radius: 8px; border: 1px solid rgba(165, 243, 252, 0.2); }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div style="text-align:center; border: 1px solid var(--ice-blue); padding: 40px; border-radius: 15px; width: 350px; background: #05050a;">
        <h2 style="font-family:'Cinzel'; color:var(--ice-blue);">WINTER LOUNGE</h2>
        <input id="regName" placeholder="Username" style="display:none;">
        <input id="authEmail" type="email" placeholder="Email">
        <input id="authPass" type="password" placeholder="Password">
        <button class="nav-btn" style="width:100%; margin-top: 10px;" onclick="handleAuth()">ENTER</button>
        <p onclick="toggleMode()" style="font-size:0.7rem; cursor:pointer; color:#666; margin-top:15px;">Switch Mode</p>
    </div>
</div>

<header>
    <div style="font-family:'Cinzel'; color:var(--ice-blue); letter-spacing:5px;">‚ùÑ DIAMOND LOUNGE</div>
    <div id="headerBalance" style="color:var(--ice-blue); font-weight:bold;">‚ô¶ 0</div>
</header>

<div id="mainView" class="main-layout" style="display:none">
    <nav class="nav-sidebar">
        <button class="nav-btn active" id="btn-explore" onclick="switchTab('explore')">Lounge</button>
        <button class="nav-btn" id="btn-wheel" onclick="switchTab('wheel')">Frost Vault</button>
        <button class="nav-btn" id="btn-profile" onclick="switchTab('profile')">Identity</button>
        <button class="nav-btn" id="btn-shop" onclick="switchTab('shop')">Shop</button>
        <button class="nav-btn" id="btn-inventory" onclick="switchTab('inventory')">Inventory</button>
        <button class="nav-btn" style="margin-top:auto; color:crimson;" onclick="auth.signOut()">Logout</button>
    </nav>

    <main id="centerContent">
        <section id="view-explore" class="view-section" style="display:block;">
            <div id="cardsContainer" class="card-grid"></div>
        </section>

        <section id="view-wheel" class="view-section" style="text-align:center;">
            <h2 style="font-family:'Cinzel'; color:var(--ice-blue);">FROST VAULT</h2>
            <div class="wheel-box">
                <div id="wheel">
                    <div class="wheel-segment" style="transform:rotate(0deg)">‚ô¶ 5</div>
                    <div class="wheel-segment" style="transform:rotate(45deg)">+50 XP</div>
                    <div class="wheel-segment" style="transform:rotate(90deg)">‚ô¶ 10</div>
                    <div class="wheel-segment" style="transform:rotate(135deg)">JACKPOT</div>
                    <div class="wheel-segment" style="transform:rotate(180deg)">‚ô¶ 1</div>
                    <div class="wheel-segment" style="transform:rotate(225deg)">+10 XP</div>
                    <div class="wheel-segment" style="transform:rotate(270deg)">‚ô¶ 25</div>
                    <div class="wheel-segment" style="transform:rotate(315deg)">SKIPPED</div>
                </div>
            </div>
            <button class="nav-btn" id="spinBtn" onclick="spinWheel()">ACTIVATE VAULT</button>
        </section>

        <section id="view-profile" class="view-section">
            <div style="background: var(--glass); padding: 30px; border-radius: 12px; border: 1px solid rgba(165,243,252,0.2);">
                <h3 style="font-family:'Cinzel'; color:var(--ice-blue);">Identity Editor</h3>
                <input id="newAvatar" placeholder="Avatar URL">
                <input id="newBadge" placeholder="Custom Badge (e.g. ‚ùÑÔ∏è Elite)">
                <button class="nav-btn" style="width:100%;" onclick="updateProfile()">Save Identity</button>
            </div>
        </section>

        <section id="view-shop" class="view-section">
            <h2 style="font-family:'Cinzel'; color:var(--ice-blue); text-align:center;">Winter Shop</h2>
            <div id="shopContainer" class="shop-grid"></div>
        </section>

        <section id="view-inventory" class="view-section">
            <h2 style="font-family:'Cinzel'; color:var(--ice-blue); text-align:center;">Your Inventory</h2>
            <div id="inventoryContainer" class="inventory-grid"></div>
        </section>
    </main>

    <aside class="right-sidebar">
        <div id="chatBox"></div>
        <input id="chatInput" placeholder="Chat..." onkeypress="if(event.key==='Enter') sendChat()">
    </aside>
</div>

<script>
// --- FIREBASE INIT ---
const firebaseConfig = {
    apiKey: "AIzaSyCDll8RH1kzGOf-ixJmSlHXGssOHSMlO3s",
    authDomain: "vibely-5128e.firebaseapp.com",
    projectId: "vibely-5128e",
    storageBucket: "vibely-5128e.firebasestorage.app",
    messagingSenderId: "1048550825812",
    appId: "1:1048550825812:web:fc5bbba51e065807ffb2c1"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

let isLogin = true;
let myProfile = null;
const OWNER_UID = "pqPGbhBjvrVrgDrmUBa4J2ynmkW2";

// --- AUTH ---
function toggleMode() { isLogin = !isLogin; document.getElementById('regName').style.display = isLogin ? 'none' : 'block'; }

async function handleAuth() {
    const e = document.getElementById('authEmail').value;
    const p = document.getElementById('authPass').value;
    const n = document.getElementById('regName').value;
    try {
        if (isLogin) await auth.signInWithEmailAndPassword(e, p);
        else {
            const r = await auth.createUserWithEmailAndPassword(e, p);
            await db.collection('users').doc(r.user.uid).set({
                name: n || "New Traveler", vibes: 50, xp: 0, avatar: "", badge: "‚ùÑÔ∏è Newcomer", inventory: {}, equipped: {}
            });
        }
    } catch (err) { alert(err.message); }
}

auth.onAuthStateChanged(user => {
    if (user) {
        document.getElementById('loginOverlay').style.display = 'none';
        document.getElementById('mainView').style.display = 'grid';
        loadApp(user.uid);
        loadShop();
    } else {
        document.getElementById('loginOverlay').style.display = 'flex';
        document.getElementById('mainView').style.display = 'none';
    }
});

function switchTab(t) {
    document.querySelectorAll('.view-section').forEach(v => v.style.display='none');
    document.getElementById('view-' + t).style.display='block';
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('btn-' + t).classList.add('active');
}

// --- CORE APP ---
function loadApp(uid) {
    db.collection('users').doc(uid).onSnapshot(d => {
        if (d.exists) {
            myProfile = d.data();
            document.getElementById('headerBalance').innerText = `‚ô¶ ${myProfile.vibes}`;
            loadInventory();
        }
    });

    db.collection('users').onSnapshot(snap => {
        const cont = document.getElementById('cardsContainer');
        cont.innerHTML = '';
        snap.forEach((doc, i) => {
            const u = doc.data();
            const level = Math.floor((u.xp || 0) / 100) + 1;
            const xpPercent = (u.xp || 0) % 100;
            
            const aura = u.equipped?.aura === 'sparkle' ? 'box-shadow: 0 0 20px rgba(165, 243, 252, 0.8);' : '';
            const frost = u.equipped?.cardEffect === 'frost' ? 'border: 2px solid #a5f3fc;' : '';
            const nameClass = u.equipped?.nameStyle === 'gold' ? 'gold-name' : '';
            const shimmer = u.equipped?.xpBar === 'shimmer' ? 'shimmer-bar' : '';

            cont.innerHTML += `
                <div class="user-card" style="${aura}${frost} animation-delay:${i * 0.1}s">
                    <div class="card-avatar"><img src="${u.avatar || 'https://api.dicebear.com/7.x/bottts/svg?seed=' + u.name}"></div>
                    <div class="${nameClass}" style="font-family:'Cinzel'; color:var(--ice-blue);">${u.name}</div>
                    <div style="font-size:0.6rem; color:#888; margin-bottom:5px;">${u.equipped?.badge || u.badge || ''}</div>
                    <div style="color:var(--gold); font-size:0.8rem;">‚ô¶ ${u.vibes}</div>
                    <div class="card-level">Lvl ${level}</div>
                    <div class="card-xp"><div class="card-xp-fill ${shimmer}" style="width:${xpPercent}%;"></div></div>
                </div>`;
        });
    });
}

// --- SHOP & INVENTORY ---
const shopItems = [
    {id:'sparkleAura', name:'Sparkle Aura', cost:50, desc:'Northern Lights glow', effect:(eq)=>eq.aura='sparkle'},
    {id:'frostBorder', name:'Frost Border', cost:75, desc:'Encased in ice', effect:(eq)=>eq.cardEffect='frost'},
    {id:'shimmerXP', name:'Shimmer XP Bar', cost:40, desc:'Frozen energy bar', effect:(eq)=>eq.xpBar='shimmer'},
    {id:'eliteBadge', name:'Elite Badge ‚ùÑ', cost:30, desc:'Regulars only', effect:(eq)=>eq.badge='‚ùÑÔ∏è Elite'},
    {id:'goldName', name:'Gilded Name', cost:150, desc:'Shine in pure gold', effect:(eq)=>eq.nameStyle='gold'},
    {id:'iceCrown', name:'Ice Crown', cost:250, desc:'The ultimate status', effect:(eq)=>eq.badge='üëë Ice King'},
    {id:'snowStorm', name:'Snowstorm', cost:100, desc:'Persistent snowfall', effect:(eq)=>eq.cardEffect='storm'}
];

function loadShop() {
    const cont = document.getElementById('shopContainer'); cont.innerHTML = '';
    shopItems.forEach(item => {
        cont.innerHTML += `
            <div class="shop-card">
                <div style="color:var(--ice-blue); font-family:'Cinzel';">${item.name}</div>
                <div style="font-size:0.7rem; color:#aaa; margin:10px 0;">${item.desc}</div>
                <div style="color:var(--gold); margin-bottom:15px;">‚ô¶ ${item.cost}</div>
                <button class="nav-btn" style="width:100%" onclick="buyItem('${item.id}')">Purchase</button>
            </div>`;
    });
}

async function buyItem(itemId) {
    const item = shopItems.find(i => i.id === itemId);
    if (auth.currentUser.uid !== OWNER_UID && myProfile.vibes < item.cost) { alert("Not enough Diamonds!"); return; }
    let inv = myProfile.inventory || {}; inv[itemId] = true;
    await db.collection('users').doc(auth.currentUser.uid).update({
        vibes: auth.currentUser.uid !== OWNER_UID ? firebase.firestore.FieldValue.increment(-item.cost) : myProfile.vibes,
        inventory: inv
    });
    alert("Purchased!");
}

function loadInventory() {
    const cont = document.getElementById('inventoryContainer'); if (!cont) return;
    cont.innerHTML = '';
    const inv = myProfile.inventory || {};
    Object.keys(inv).forEach(id => {
        const item = shopItems.find(i => i.id === id);
        if (item) cont.innerHTML += `<div class="inventory-card">
            <div style="color:var(--ice-blue);">${item.name}</div>
            <button class="nav-btn" style="width:100%; margin-top:10px;" onclick="equipItem('${id}')">Equip</button>
        </div>`;
    });
}

async function equipItem(itemId) {
    const item = shopItems.find(i => i.id === itemId);
    let eq = myProfile.equipped || {}; item.effect(eq);
    await db.collection('users').doc(auth.currentUser.uid).update({ equipped: eq });
}

// --- WHEEL WITH TIMER & JACKPOT ---
async function spinWheel() {
    const btn = document.getElementById('spinBtn');
    if (btn.disabled) return;

    // Timer Logic
    if (auth.currentUser.uid !== OWNER_UID && myProfile.lastSpin) {
        const last = myProfile.lastSpin.toDate();
        const diff = new Date() - last;
        const cooldown = 24 * 60 * 60 * 1000;
        if (diff < cooldown) {
            const remaining = cooldown - diff;
            const h = Math.floor(remaining / 3600000);
            const m = Math.floor((remaining % 3600000) / 60000);
            alert(`Vault is frozen. Try again in ${h}h ${m}m.`); return;
        }
    }

    btn.disabled = true;
    const index = Math.floor(Math.random() * 8);
    document.getElementById('wheel').style.transform = `rotate(${3600 + (index * 45)}deg)`;

    setTimeout(async () => {
        const rewards = [{v:5},{x:50},{v:10},{v:100, j:true},{v:1},{x:10},{v:25},{v:0}];
        const win = rewards[index];
        const up = { lastSpin: firebase.firestore.FieldValue.serverTimestamp() };
        if (win.v) up.vibes = firebase.firestore.FieldValue.increment(win.v);
        if (win.x) up.xp = firebase.firestore.FieldValue.increment(win.x);
        
        await db.collection('users').doc(auth.currentUser.uid).update(up);
        alert(win.j ? "‚ùÑÔ∏è JACKPOT! 100 Diamonds! ‚ùÑÔ∏è" : "Vault Opened!");
        btn.disabled = false;
    }, 5500);
}

// --- CHAT & SNOW ---
async function updateProfile() {
    const avatar = document.getElementById('newAvatar').value;
    const badge = document.getElementById('newBadge').value;
    await db.collection('users').doc(auth.currentUser.uid).update({ avatar, badge });
    alert("Identity Updated.");
}

function sendChat() {
    const msg = document.getElementById('chatInput').value.trim();
    if (msg) db.collection('chat').add({ user: myProfile.name, msg, time: firebase.firestore.FieldValue.serverTimestamp() });
    document.getElementById('chatInput').value = '';
}

db.collection('chat').orderBy('time', 'desc').limit(15).onSnapshot(s => {
    const box = document.getElementById('chatBox'); box.innerHTML = '';
    s.docs.reverse().forEach(d => box.innerHTML += `<div class="chat-msg"><b>${d.data().user}:</b> ${d.data().msg}</div>`);
    box.scrollTop = box.scrollHeight;
});

setInterval(() => {
    const s = document.createElement('div'); s.className = 'snowflake';
    s.innerHTML = Math.random() < 0.8 ? '‚ùÑ' : '‚ú®';
    s.style.left = Math.random() * 100 + 'vw';
    s.style.animationDuration = (Math.random() * 3 + 3) + 's';
    document.body.appendChild(s);
    setTimeout(() => s.remove(), 6000);
}, 250);
</script>

</body>
</html>
